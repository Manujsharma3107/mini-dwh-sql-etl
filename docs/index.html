<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Data Warehouse â€” E-commerce KPIs</title>

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Plotly for charts -->
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --primary:#3b82f6;
      --ring:#e2e8f0;
      --shadow:0 4px 20px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{margin:0;background:var(--bg);color:var(--ink)}
    .container{max-width:1200px;margin:0 auto;padding:28px 18px}
    .hero{
      background:linear-gradient(90deg,#f8fafc,#e2e8f0);
      border-left:6px solid var(--primary);
      border-radius:14px;padding:28px 24px;margin:6px 0 26px 0; box-shadow:0 2px 8px rgba(0,0,0,.04)
    }
    .title{font-size:32px;font-weight:800;letter-spacing:-.02em;text-align:center;margin:4px 0 8px}
    .sub{color:var(--muted);text-align:center}
    .grid{display:grid;gap:18px}
    @media(min-width:860px){.grid.cols-2{grid-template-columns:1fr 1fr}.grid.cols-3{grid-template-columns:repeat(3,1fr)}.grid.cols-4{grid-template-columns:repeat(4,1fr)}}

    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:18px}
    .metric{display:flex;flex-direction:column;gap:6px}
    .metric-label{font-size:12px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
    .metric-value{font-size:28px;font-weight:800}
    .metric-pill{width:48px;height:48px;border-radius:12px;color:#fff;display:flex;align-items:center;justify-content:center;margin-bottom:8px}
    .pill-green{background:linear-gradient(135deg,#10b981,#059669)}
    .pill-blue{background:linear-gradient(135deg,#3b82f6,#2563eb)}
    .pill-amber{background:linear-gradient(135deg,#f59e0b,#d97706)}
    .pill-violet{background:linear-gradient(135deg,#8b5cf6,#7c3aed)}
    .section{font-size:18px;font-weight:800;margin:22px 2px 10px}
    .chart{height:380px}
    .muted{color:var(--muted)}
    .kpi-wrap{display:grid;gap:18px}
    @media(min-width:860px){.kpi-wrap{grid-template-columns:repeat(4,1fr)}}
  </style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <div class="title">Mini Data Warehouse â€” E-commerce KPIs</div>
      <div class="sub">Static snapshot (instant load). Built from CSV/API â†’ SQLite views.</div>
    </div>

    <!-- KPI cards -->
    <div class="kpi-wrap">
      <div class="card metric"><div class="metric-pill pill-green">ðŸ’°</div><div class="metric-label">Revenue</div><div id="m-rev" class="metric-value">â€“</div></div>
      <div class="card metric"><div class="metric-pill pill-blue">ðŸ›’</div><div class="metric-label">Orders</div><div id="m-ord" class="metric-value">â€“</div></div>
      <div class="card metric"><div class="metric-pill pill-amber">ðŸ“Š</div><div class="metric-label">Average Order Value</div><div id="m-aov" class="metric-value">â€“</div></div>
      <div class="card metric"><div class="metric-pill pill-violet">âœ…</div><div class="metric-label">DQ Issues</div><div id="m-dq" class="metric-value">â€“</div></div>
    </div>

    <div class="grid cols-2" style="margin-top: 18px;">
      <div class="card">
        <div class="section">Monthly KPIs</div>
        <div id="chart-monthly" class="chart"></div>
      </div>
      <div class="card">
        <div class="section">Top 10 Products by Revenue</div>
        <div id="chart-top" class="chart"></div>
      </div>
    </div>

    <div class="card" style="margin-top:18px">
      <div class="section">Category Contribution</div>
      <div id="chart-cat" class="chart"></div>
      <div class="muted" style="margin-top:8px">* Shares are computed from exported revenue totals.</div>
    </div>

    <p class="muted" style="margin-top:28px">Â© Data snapshot generated from your SQLite views; rendered as a static page for instant loading.</p>
  </div>

  <script>
    const fmt = n => n.toLocaleString('en-IN');
    const money = n => 'â‚¹' + n.toLocaleString('en-IN');

    async function main(){
      const resp = await fetch('data.json');
      const data = await resp.json();

      // KPIs
      document.getElementById('m-rev').textContent = money(Math.round(data.revenue || 0));
      document.getElementById('m-ord').textContent = fmt(data.orders || 0);
      document.getElementById('m-aov').textContent = money(Math.round(data.aov || 0));
      document.getElementById('m-dq').textContent  = fmt(data.dq_issues || 0);

      // Monthly
      const months   = data.monthly_kpis.map(d => d.month);
      const rev      = data.monthly_kpis.map(d => d.revenue);
      const orders   = data.monthly_kpis.map(d => d.orders);

      const tr1 = { x: months, y: rev, name:'Revenue', type:'scatter', mode:'lines+markers', line:{width:3} };
      const tr2 = { x: months, y: orders, name:'Orders', type:'bar', opacity:.35, marker:{line:{width:0}} };

      Plotly.newPlot('chart-monthly', [tr1,tr2], {
        margin:{l:40,r:20,t:10,b:40},
        legend:{orientation:'h'},
        yaxis:{title:'Revenue'},
        xaxis:{type:'category'}
      }, {displayModeBar:false, responsive:true});

      // Top products
      const topX = data.top_products.map(d => d.product_id);
      const topY = data.top_products.map(d => d.revenue);
      Plotly.newPlot('chart-top', [{
        x: topX, y: topY, type:'bar'
      }], {
        margin:{l:40,r:20,t:10,b:40},
        xaxis:{title:'product_id'}, yaxis:{title:'revenue'}
      }, {displayModeBar:false, responsive:true});

      // Category contribution
      const catL = data.category_contrib.map(d => d.category);
      const catV = data.category_contrib.map(d => d.revenue);
      Plotly.newPlot('chart-cat', [{
        labels: catL, values: catV, type:'pie', hole:.45
      }], {
        margin:{l:20,r:20,t:10,b:20},
        legend:{orientation:'h'}
      }, {displayModeBar:false, responsive:true});
    }
    main();
  </script>
</body>
</html>
